
  ██▓▒██▓▒██▓▒░██▓▒██▓▒██▓▒░██▓▒█████▓▒█████▓▒░ ████▓▒░████▓▒░██▓▒░   (C) ANS
  ██▓▒██▓▒███▓▒██▓▒██▓▒██▓▒░██▓▒██▓▒░  ██▓▒██▓▒██▓▒░  ██▓▒██▓▒██▓▒░  (Armourer)
  ██▓▒██▓▒██▓█▓██▓▒██▓▒██▓▒░██▓▒████▓▒░█████▓▒░ ███▓▒░██████▓▒██▓▒░   Jul 1995
  ██▓▒██▓▒██▓▒███▓▒██▓▒░██▓██▓▒░██▓▒░  ██▓▒██▓▒   ██▓▒██▓▒██▓▒██▓▒░    ------
   ████▓▒░██▓▒░██▓▒██▓▒░ ███▓▒░ █████▓▒██▓▒██▓▒████▓▒░██▓▒██▓▒█████▓▒░

    ╓╖     ╓╥╥╥╥╖     ░▒▓██░▒▓██▒▓██████▒▓█████░▒▓██▒▓█████▒▓██▒▓█████▒▓█████
   ╓╢║     ║╟╨╨╢║     ░▒▓███▓███▒▓██▒▓██▒▓██▒▓██▒▓██▒▓██  ░▒▓██▒▓██  ░▒▓██▒▓██
  ╓╫╢║     ║║  ║║     ░▒▓██▓█▓██▒▓██▒▓██▒▓██▒▓██▒▓██▒▓████░▒▓██▒▓████░▒▓█████
  ╙╜║║     ║║  ║║     ░▒▓██░▒▓██▒▓██▒▓██▒▓██▒▓██▒▓██▒▓██  ░▒▓██▒▓██  ░▒▓██▒▓██
    ║║     ║║  ║║     ░▒▓██░▒▓██▒▓██████▒▓█████░▒▓██▒▓██  ░▒▓██▒▓█████▒▓██▒▓██
    ║║     ║║  ║║
    ║║     ║║  ║║     ╓─── ╓──╖ ╓─── ╓─── ╓   ╖ ╓──╖ ╓──╖ ╓───              ╓╖
    ║║     ║║  ║║     ╟──  ╟─╥╜ ╟──  ╟──  ║ ╥ ║ ╟──╢ ╟─╥╜ ╟──               ║║
    ║║     ║║  ║║     ╙    ╙  ╙ ╙─── ╙───  ╙╨╜  ╙  ╜ ╙  ╙ ╙─── ╕            ║║
    ║║     ║║  ║║     ╓──╖ ╓──╖ ╓  ╖ ╓──╖ ╓──╖ ╓─── ╓   ╖ ╓──╖ ╓──╖ ╓───    ║║
    ║║     ║║  ║║     ╙──╖ ║  ║ ║  ║ ╟─╥╜ ║    ╟──  ║ ╥ ║ ╟──╢ ╟─╥╜ ╟──     ║║
    ║║     ║║  ║║     ╙──╜ ╙──╜ ╙──╜ ╙  ╙ ╙──╜ ╙───  ╙╨╜  ╙  ╜ ╙  ╙ ╙───    ╙╜
   ╓╢╟╖ ╓╖ ║╟╥╥╢║ ╓╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╥╖ ╓╖
   ╙╨╨╜ ╙╜ ╙╨╨╨╨╜ ╙╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╨╜ ╙╜


  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ██  (C)  ANS  (Armourer)  ▄▄  Universal Modifier  1.00  ▄▄  25 Jul  ██▓▓▒▒░░
  ██  FIDOnet 2:461/29.444  ▀▀    FreeWare, Sourceware    ▀▀   1995   ██▓▓▒▒░░
  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  П Р Е Д И С Л О В И Е  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Я предлагаю ознакомиться с этой программой всем, кто интересуется
  ▄	вопросами защиты программ, взлома защит программ, борьбы с вирусами,
  ▄	просто программированием на ассемблере 8086.
  ▄
  ▄	Отзывы и предложения можно направлять мне по адресу:
  ▄	FIDOnet 2:461/29.444, Andrey Petrov
  ▄	или по телефонам (0572) 45-91-83, 45-91-03 в рабочее время.
  ▄
  ▄	Я регулярно (надеюсь ;) читаю RU.HACKER, PVT.CRACK, TALKS.ASM,
  ▄	DEMO.DESIGN, KHARKOV.FRIENDS :)
  ▄	Можете подискутировать со мной там (где это допускают рулесы ;)
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Universal Modifier ── что это и зачем  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Эта утилита облегчает действия по модификации файлов (программ)
  ▄	(как-то: навешивание своего кода повех чужого, преобразование
  ▄	между различными форматами, шифрование/дешифрование, etc.)
  ▄	В первую очередь она интересна (imho) именно своей универсальностью,
  ▄	что и отражено в ее названии.
  ▄
  ▄	Возможно, программа может представлять интерес как иллюстрация
  ▄	определенного подхода к кодированию для процессоров семейства 8086.
  ▄
  ▄	В комплект поставки входят несколько примеров модификаторов (*.mdf),
  ▄	на основе которых можно легко сделать нечто свое.
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Как пользоваться Universal Modifier'ом  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Формат запуска элементарно прост:
  ▄
  ▄		  mdf <input> <output> <module> [par's]
  ▄
  ▄	где <input> - имя входного файла, который нужно модифицировать,
  ▄	   <output> - имя выходного (модифицированного> файла
  ▄	   <module> - имя .mdf-модуля, который будет выполнять модификацию,
  ▄	    [par's] - необязательные параметры, которые могут потребоваться
  ▄	    	      конкретному .mdf-модулю.
  ▄
  ▄	Работает это так:
  ▄	1. Читается <input>, определяется его длина
  ▄	2. В текущем каталоге создается <output>
  ▄	3. Читается файл <module>.
  ▄	4. Управление передается startup-процедуре из файла <module>,
  ▄	   выполняющей всю основную работу
  ▄	5. В файл <output> пишется сначала основной код .mdf-модуля, а затем -
  ▄	   обработанные startup-процедурой данные из файла <input>.
  ▄
  ▄	░▒▓█  В  █▓▒░	Я _не_ рекомендую Вам задавать одинаковые имена для
  ▄	░▒▓█  Н  █▓▒░	<input> и <output>-файлов. Это в принципе возможно,
  ▄	░▒▓█  И  █▓▒░	но при этом в случае любого сбоя в работе .mdf или
  ▄	░▒▓█  М  █▓▒░	при невозможности найти сам .mdf Вы просто лишитесь
  ▄	░▒▓█  А  █▓▒░	<input>-файла ! Это связано с тем, что <output>-файл
  ▄	░▒▓█  Н  █▓▒░	создается сразу после считывания в буфер <input>-файла,
  ▄	░▒▓█  И  █▓▒░	но до открытия .mdf, и, соответственно, до отработки
  ▄	░▒▓█  Е  █▓▒░	startup-процедуры. Будьте внимательны !
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Как делать свои модификаторы  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Как Вы уже неоднократно поняли ;) главную роль во всей этой истории
  ▄	играет код в файле <module>, который Вы можете разработать сами
  ▄	(на это как раз и намекает слово "Universal" в названии программы :)
  ▄
  ▄	Формат файла <module> необыкновенно прост: это бинарный файл,
  ▄	последние два байта которого указывают смещение startup-процедуры
  ▄	в файле. Единственное, что следует четко понимать - это НЕ .com-файл,
  ▄	т.е. при выполнении кода startup-процедуры НЕ создается PSP, смещение
  ▄	первого байта файла в памяти равно 0, а не 100h, управление
  ▄	startup-процедуре передается командой CALL FAR, следовательно
  ▄	управление после инициализационных операций следует отдать по RET FAR.
  ▄
  ▄	При вызове startup-процедуры действует следующее соглашение
  ▄	о передаче параметров:
  ▄	- на входе в startup-процедуру по адресу ES:0 лежит содержимое
  ▄	  файла <input>; в регистре DI лежит длина файла <input>;
  ▄	  регистр DS совпадает с CS;
  ▄	  по адресу SS:BP лежит тот самый [par's], т.e. хвост командной
  ▄	  строки за <module>, терминированный словом dw 0 (ведущие пробелы
  ▄	  в этом хвосте уже убраны).
  ▄	- на выходе от startup-процедуры ожидается новое значение длины
  ▄	  содержимого <input> (сегмент ES), которое должно быть помещено
  ▄	  в регистр DI.
  ▄	  В регистре CX ожидается длина основного кода .mdf-модуля,
  ▄	  а в DX - смещение основного кода в сегменте файла <module>
  ▄	  (сегмент DS).
  ▄	Содержимое остальных регистров неопределено.
  ▄
  ▄	Все рабочие регистры сохраняются перед вызовом startup-процедуры.
  ▄
  ▄	В комплект поставки входят примеры файлов *.mdf с исходными текстами.
  ▄	(См. подкаталог EXAMPLES, файл examples.doc)
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Замечания  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Нет возможности обрабатывать файлы длиннее 64 K. Возможно,
  ▄	если будет потребность, я сделаю это в следующей версии.
  ▄
  ▄	При запуске не проверяется наличие необходимого объема свободной
  ▄	оперативной и дисковой памяти - просто влом (из предположения,
  ▄	что 129 Kb RAM и 64 Kb disk space (max) не представляют сейчас проблемы
  ▄	для кого бы то ни было (включая пользователей K O M ]~[ b !-0 T E P A
  ▄	"ПрОИСК" ;))
  ▄
  ▄	Минимизирован объем сообщений об ошибках - ввиду элементарности
  ▄	файловых операций.
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Условия поставки  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Universal Modifier 1.00 распространяется как FREEWARE,
  ▄	т.е. Вы можете неограниченно копировать, распространять,
  ▄	использовать и рекламировать :) саму программу и все примеры,
  ▄	входящие в комплект поставки с единственным условием:
  ▄	_______________________________________________________________
  ▄	! НЕИЗМЕННОСТИ КОДА, КОМПЛЕКТНОСТИ и СОДЕРЖИМОГО ДОКУМЕНТАЦИИ !
  ▄	~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ▄	Если Вы хотите использовать что-либо из комплекта поставки
  ▄	в коммерческих целях - ради бога, я не возражаю. Только известите
  ▄	об этом меня - для рекламы Вашей и Моей ;)
  ▄
  ▄	Если Вы изменили хоть один байт в программе - пожауйста,
  ▄	не распространяйте ее больше под именем "Universal Modifier" !
  ▄	Назовите получившееся как хотите, но название оригинального пакета
  ▄	принадлежит мне. Я отдаю Вам все права, кроме права на имя !
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  Список файлов  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	Список файлов, входящих в комплект поставки Universal Modifier:
  ▄
  ▄	\MDF.100			Основной каталог
  ▄	 mdf.doc	7,327	Этот файл
  ▄	 mdf.asm	9,063	Исходный текст Universal Modifier
  ▄	 mdf.com          512	Исполняемый файл
  ▄
  ▄	\MDF.100\EXAMPLES		Примеры модулей .mdf
  ▄	 examples.doc		Описания примеров
  ▄
  ▄	\MDF.100\EXAMPLES\COM2EXE	Преобразование .com в .exe и обратно
  ▄	\MDF.100\EXAMPLES\EXE2BIN	Аналог exe2bin из поставки DOS
  ▄	\MDF.100\EXAMPLES\SETVER	Хитрый SetVer для особо "умных"
  ▄	\MDF.100\EXAMPLES\XORER		Простейшее кодирование .com-файлов
  ▄
  ▄
  ▄
  ▄  ██▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄  ██  История  ██▓▓▒▒░░
  ▄  ██▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
  ▄
  ▄	1.00	25.07.95	Первая версия. 4 примера .mdf
  ▄				Так и осталась в "застенках" автора
  ▄
  ▄
  ▄							█▀▀▀▀▀▀▀▀▀▀▀▀██▓▓▒▒░░
  ▄							█ That's all ██▓▓▒▒░░
  ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ ▄ █▄▄▄▄▄▄▄▄▄▄▄▄██▓▓▒▒░░
