FFORMAT.TXT v2.99F/286                    Last UpDate: 09.03.1995

 2.99F/286 - добавлена процедура определения запуска под WinNT, 
             модифицирована процедура определения OS/2.
             Курсор мыши становится в виде песочных часов в момент
             чтения данных с диска.
             Исправлены орфографические ошибки и неточности.
             Уменьшен размер основного модуля FFORMAT.EXE.
             Приведены примеры использования оригинальных BOOT-секторов.

Содержание:
~~~~~~~~~~~
  1. Основные возможности
  2. Требования к системе
  3. Комплект поставки
  4. FFORMAT - программа для форматирования гибких дисков
  5. Опции командной строки
  6. Описание поддерживаемых форматов
  7. Зачем это нужно ?
  8. Различные режимы форматирования
  9. О восстановлении дискет
 10. Проблемы с PU_1700: теперь их нет
 11. По поводу загрузочных дискет и прочего
 12. Внутренние ошибки
 13. Небольшое ограничение
 14. Приложение
     1. Ошибки и несовместимости, найденные в процессе работы
     2. Информация для любителей переделывания VFORMAT
     3. Скорости передачи данных дисководов
     4. Как я форматирую со скоростью DOS'овского FORMAT
     5. О предыдущих версиях

Основные возможности
~~~~~~~~~~~~~~~~~~~~
  - поддержка нестандартных форматов дискет от 180 Кб до 1.74 Мб
  - увеличение производительности дискет как минимум в 1.5 раза
  - изготовление загрузочной дискеты на любой формат диска
  - восстановление поврежденных дорожек дискеты
  - полная совместимость с утилитами типа PU_1700 и 800
  - обеспечивается работа в среде Windows (DOS Box)
  - поддержка DESQView, работа в окне
  - двуязычный режим работы
  - оригинальный загрузчик (BOOT-сектор)

Требования к системе
~~~~~~~~~~~~~~~~~~~~
  - IBM PC AT 286 и выше
  - CGA, EGA, VGA, Hercules видео адаптер
  - MS DOS 3.30 или выше
  - 230 Кб оперативной памяти, 350 Кб рекомендуется
  - Дисководы от 360 Кб до 1.44 Мб (2.88 пока не поддерживаются)

Комплект поставки:
~~~~~~~~~~~~~~~~~~
  FFORMAT.EXE - собственно программа для форматирования
  FFORMAT.INI - файл конфигурации для FFORMAT.EXE
  FFORMAT.TXT - это тот файл, который вы сейчас читаете
  FFORMAT.PIF - .PIF файл для Windows
  FFORMAT.ICO - иконка для Windows
  FF_OLD.ICO  - старый вариант иконки
  FF-PIF.DVP  - файл описания для DESQView
  FDS.EXE     - Floppy Drives Setup: программа для установки
                параметров дисковода для DOS
  FDS.DOC     - документация к ней
    *.BSC     - внешние загрузчики
  CMDLINE.TXT - опции командной строки для FFORMAT.EXE
  BOOT_HD.BAT - пример использования оригинального BOOT-сектора
  VBFD.BAT    - пример использования оригинального BOOT-сектора

FFORMAT.EXE - программа для форматирования гибких дисков
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     FFORMAT.EXE Версия 2.99F - новая  версия программы реализует
возможности,  которых  пока  нет  ни  у  одной  из  известных мне
программ,   предназначенных   для   форматирования.  Не   спешите
выбрасывать  дискету  с поврежденной  0 дорожкой!  Есть шанс, что
FFORMAT   восстановит   ее   (в   85%   случаев   FFORMAT   может
отформатировать дискету, которую не может отформатировать ни одна
программа !).

     Работоспособна в версиях DOS 3.3 и выше. Не прерывается Task
Swaper'ом DOS 5.00-6.00, а также Windows  в стандартном режиме, а
в  расширенном режиме  я свободно  форматировал  одновременно две
дискеты в  разных дисководах  (естественно 2-мя копиями FFORMAT).

     Прекрасно  уживается с  DESQView  - работает в окне,  правда
немного медленнее чем обычно.

     Пользователи    PU_1700!    Данная    программа    позволяет
отформатировать дискеты  на  все  форматы,  которые  поддерживает
PU_1700,  включая оптимизацию секторов и изготовление загрузочных
дискет,  и  делает  это  быстрее,  чем  PU_1700,  а  также  умеет
восстанавливать дорожки дискеты  (в том числе и 0-ю). Теперь  вам
не нужно отключать PU_1700 перед  запуском FFORMAT: автоматически
распознаются несколько  версий PU_1700,  а  также 800.  При  этом
PU_1700 на время работы FFORMAT отключается.

     FFORMAT загружает  знакогенератор  на  EGA/VGA, и делает это
только в  том  случае, если есть подходящий шрифт. FFORMAT  имеет
шрифты 8x14 и 8x16, что позволяет  работать на "нормальных" EGA и
VGA в режиме 25  строк. Если у вас будут проблемы,  связанные  со
знакогенератором (а также другие) при работе с FFORMAT, позвоните
по  телефону,  приведенному  в  конце  этого  описания.  Если  вы
выставили 43  или  50 строк на EGA/VGA то FFORMAT на время работы
переведет адаптер в режим 25 строк, а после выхода вернет прежний
режим. При использовании специальных утилит для сохранения режима
43  или  50 строк,  FFORMAT  будет,  возможно, работать  в  43/50
строках не  загружая знакогенератор. Однако использоваться  будут
только первые 25 строк.

NOTE: Возможно  неправильное функционирование при наличии 30  или
60 строк: адаптер будет, возможно, переведен в режим 25 строк.

Опции командной строки:
~~~~~~~~~~~~~~~~~~~~~~~
    /? or /HELP - показать экран подсказки
    /MT         - помечать всю дорожку при обнаружении хотя бы
                  одного сбойного сектора
    /R0         - восстанавливать только нулевую дорожку
    /ROOT:xx    - установить размер корневого каталога в xx
                  секторов (один сектор содержит 16 входов в
                  корневой каталог). Значения от 1 до 14.
    /I          - заставить форматировать с интерливом.
                  Пользоваться этим ключом не рекомендуется т.к.
                  это сильно замедляет чтение/запись.
                  FFORMAT автоматически выбирает нужный интерлив,
                  однако на старых контроллерах эта опция может
                  помочь, если FFORMAT отказывается форматировать
    /BOOT:file  - использовать в качестве загрузочного сектора
                  дополнительные файлы (*.BSC)
    /A          - заставляет FFORMAT запрашивать системную
                  дискету в дисковод A: и не искать системные
                  файлы на винчестере
    /L:label    - установить метку на дискете
    /BW         - переключиться в черно-белые цвета
    /ZO         - запретить "раскрытие" окон
    /DR         - запретить загрузку знакогенератора
    /RG         - загружать знакогенератор полностью
    /SW         - запретить определение API переключателя задач
    /RUS        - переключиться на русский язык

В комплект поставки входят 2 загрузочных кода:

BOOT_HD.BSC - позволяет загружаться вместо дискеты с винчестера,
              если он присутствует.
VBDF.BSC    - Vitamin-B Floppy Disk Boot v2.0.

Описание поддерживаемых форматов
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Подобно другим существующим программам  для   форматирования
гибких  дисков,  эта  программа  действительно форматирует гибкие
диски на любой  формат и позволяет  просматривать каталоги дисков
перед форматированием  без  драйверов  800  и  PU_1700.  Главное,
что   выгодно  отличает  FFORMAT   от   других   программ  -  это
возможность    восстановления   поврежденных   дорожек   и   свой
собственный оригинальный Boot-сектор.
     Если вы случайно  оставите  в  дисководе  несистемный  диск,
отформатированный  FFORMAT, то  при  загрузке  вместо  привычного
"Non-system disk or disk error ..." вы увидите вполне  нормальный
DeskTop  с  окном, сообщающим,  что этот  диск  несистемный.  Вам
останется только вынуть диск  и  "нажать" на кнопочку "Ok" в окне
сообщений. Вся  процедура  рисования DeskTop'а и кнопки умещается
в 512 байт вместе с расширенной таблицей диска.

    Возможные варианты форматов в зависимости от типа дисковода:
     360 Кб дисковод
     +      180 Kb  40 дорожек  9 секторов 1 сторона
            200 Kb  40 дорожек 10 секторов 1 сторона
     +      320 Kb  40 дорожек  8 секторов
     +      360 Kb  40 дорожек  9 секторов
            400 Kb  40 дорожек 10 секторов
            420 Kb  42 дорожки 10 секторов
            430 Kb  43 дорожки 10 секторов (может не поддержи-
                                           ваться дисководом)
     720 Кб дисковод (3'5" и 5'25")
     +      720 Kb  80 дорожек  9 секторов
     +      747 Kb  83 дорожки  9 секторов (Чуть-чуть, но
                                            по больше)
            800 Kb  80 дорожек 10 секторов
            820 Kb  82 дорожки 10 секторов
            830 Kb  83 дорожки 10 секторов (может не поддержи-
                                           ваться дисководом)
     1.2 Мб дисковод
     +      180 Kb  40 дорожек  9 секторов 1 сторона
            200 Kb  40 дорожек 10 секторов 1 сторона
     +      320 Kb  40 дорожек  8 секторов
     +      360 Kb  40 дорожек  9 секторов
            400 Kb  40 дорожек 10 секторов
            420 Kb  42 дорожки 10 секторов
            430 Kb  43 дорожки 10 секторов (может не поддержи-
                                           ваться дисководом)
     +      720 Kb  80 дорожек  9 секторов
     +      747 Kb  83 дорожки  9 секторов (Чуть-чуть,
                                           но по-больше)
            800 Kb  80 дорожек 10 секторов
            820 Kb  82 дорожки 10 секторов
            830 Kb  83 дорожки 10 секторов (может не поддержи-
                                           ваться дисководом)
     +      1.2 Mb  80 дорожек 15 секторов
           1.36 Mb  80 дорожек 17 секторов
           1.39 Mb  82 дорожки 17 секторов
           1.41 Mb  83 дорожки 17 секторов
           1.44 Mb  80 дорожек 18 секторов (*)
           1.47 Mb  82 дорожки 18 секторов (*)
           1.49 Mb  83 дорожки 18 секторов (*)
                                           (может не поддержи-
                                           ваться дисководом)
    1.44 Мб дисковод
    +       720 Kb  80 дорожек  9 секторов
            800 Kb  80 дорожек 10 секторов
            820 Kb  82 дорожки 10 секторов
            830 Kb  83 дорожки 10 секторов (может не поддержи-
                                           ваться дисководом)
    +      1.44 Mb  80 дорожек 18 секторов
    +      1.52 Mb  80 дорожек 19 секторов
           1.60 Mb  80 дорожек 20 секторов
           1.64 Mb  82 дорожки 20 секторов
           1.68 Mb  83 дорожки 20 секторов
           1.68 Mb  80 дорожек 21 сектор   (*)
           1.72 Mb  82 дорожки 21 сектор   (*)
           1.74 Mb  83 дорожки 21 сектор   (*)
                                           (может не поддержи-
                                           ваться дисководом)

    (*) - 800.COM не форматирует такие форматы
          При форматировании используется Interlive=2
     +  - форматы,  для  которых FFORMAT позволяет восстановить 0
          дорожку и остальные дорожки тоже

     Форматы, имеющие 83 дорожки,  могут не поддерживаться  вашим
дисководом  (особенно   если   он   старый).  Однако  большинство
современных дисководов позволяют форматировать до  84-85 дорожек.
Форматирование  на 83  дорожки  9  секторов  введено  по  просьбе
Девяткина М. Как выяснилось, компьютер "Поиск", (...),  не  может
правильно  прочитать  10  секторов   на   дорожку,  если  дискета
отформатирована на нормальном дисководе, и нормальный дисковод не
может прочитать  10  секторов, если  дискета  отформатирована  на
"Поиске",  (...). (Поиск больше  похож на PC  Jr  нежели на XT. У
него  для  обращения к  дискам  DMA не  используется (похоже, что
контроллера  DMA  там вообще  нет),  и  процессор  выполняет  все
операции путем ввода/вывода в порты. Совместимость не соблюдается
(естественно!),  и  о назначении  портов, по-моему, знают  только
разработчики BIOS  "Поиска".)  Восстановление дискет  на "Поиске"
может не работать. Претензии, я надеюсь, ясно к кому.

Зачем это нужно ?
~~~~~~~~~~~~~~~~~
     Лично  мне  надоело  набирать:  FORMAT  a: /n:xx/t:xx, затем
мучительно соображать какой установлен DOS, на предмет надобности
переключателя /u и запускать еще раз,  так как DOS оказывался  не
той версии ...

     Программа позволяет  форматировать диски  так,  что скорость
обращения  к дискете  увеличивается  в  полтора  раза  (а  в ряде
случаев  и  больше).  Суть  состоит в следующем:  когда  дисковод
перемещает  головку с дорожки на дорожку после  чтения/записи при
обычном    расположении    секторов,   первый   сектор   успевает
"ускользнуть"  от головки  и приходится  ждать еще  целый  оборот
диска,  чтобы   прочитать  его.  Замечено,  что  если  на  каждой
последующей дорожке  "сдвинуть" первый сектор на  три сектора, то
при перемещении головки он считывается  сразу  - что  и  является
причиной  увеличения  производительности.  Реально   используется
немного  измененный метод,  который  обеспечивает  более  сильное
увеличение производительности.

     Тот,  кто  форматировал дискеты разными программами, наверно
обратил  внимание  на тот  факт,  что  программой  FORMAT из  DOS
дискеты  форматируются   быстрее  всего  (SafeFormat   из  Norton
Utilites  в  DOS mode работает почти в  полтора  раза медленнее).
Однако при наличии "примочек" вроде 800  или PU_1700  и  особенно
при  форматировании на нестандартный  формат,  DOS'овский  FORMAT
становится  очень  медленным,  а   SafeFormat   вообще  не  умеет
форматировать на нестандартный формат.

     FFORMAT  позволит решить  эти проблемы: в стандартном режиме
(без   увеличения  производительности   дискет)   форматирует  со
скоростью  программы FORMAT,  при  том  что  умеет  форматировать
дискеты  на  800   Кб  без  800  или  PU_1700.  При   оптимальном
форматировании   (режим   форматирования   по  умолчанию)   время
форматирования возрастает  в среднем  на  10% -  это  меньше, чем
время форматирования FORMAT'ом с 800, и это при том, что скорость
обмена с диском будет в 1.5 раза выше! Стоит для этого  подождать
немного по-дольше?

Различные режимы форматирования
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     FFORMAT  имеет  4  режима  форматирования.  В зависимости от
ситуации  вы можете выбрать  тот  или иной режим  форматирования.
Рекомендуется  выбирать  режим  'Optimize  sectors',  как  режим,
обеспечивающий увеличение производительности дискет.

     1) стандартное форматирование (стандартное расположение
        секторов) - время аналогично SafeFormat.
     2) оптимальное расположение при форматировании (дает выигрыш
        во времени при форматировании, но не при чтении/записи) -
        время аналогично DOS FORMAT.
     3) оптимальное расположение для чтения/записи (1.5-1.7 раза
        ускоряет производительность дискет) - время на 5-10%
        медленнее предыдущего.
     4) так называемый быстрый формат (quick) - очищается таблица
        размещения файлов и корневой каталог. В принципе,
        содержимое дискеты можно восстановить. Запись
        операционной системы в этом режиме РАБОТАЕТ !

     В процессе  эксплуатации  выяснено, что  ускорение работы  с
дискетами проявляется сильнее всего на 86 и 386 машинах, а на 286
эффект несколько меньше.

О восстановлении дискет
~~~~~~~~~~~~~~~~~~~~~~~
     При  обнаружении  повреждения  0 дорожки на  дискете ни одна
программа не форматирует такую дискету. На западе  такие дискеты,
возможно,  просто выбрасывают. Для нас такой подход  не приемлем.
Дискеты стоят достаточно  дорого и качество  их  оставляет желать
лучшего.
     Один   из  способов  получения  работоспособных  дискет  был
предложен    Панковым   (автором   PU_1700):    нулевая   дорожка
перемещалась в середину дискеты. Достаточно оригинальный  способ,
однако имеет недостатки:

      1) Необходимость постоянно держать в памяти PU_1700
      2) Невозможно  прочитать обычную дискету без переустановки
         PU_1700 - что крайне неудобно на машине с 1 дисководом

     Достоинством является  то, что этот способ работает  с любым
форматом даже при полном отсутствии 0 дорожки дискеты.

     FFORMAT реализует другой метод.

     Обычно  на 0 дорожке,  а  равно  как  и на  других  дорожках
дискеты,  в  силу  различных  причин  (в  основном   механическое
повреждение),  пропадает  читабельность одного или двух  сектора.
Дискета форматируется  так, что  поврежденная  часть  поверхности
просто  не  используется.  У метода есть  недостаток:  невозможно
восстановить более  одного  сектора  на дорожке (360-720 Кб)  или
двух  (1.2-1.44  Мб), однако выбирайте:  дискета с поврежденной 0
дорожкой на 800 Кб или абсолютно нормальная на 720 Кб ?
     Кроме  восстановления  0  дорожки,  FFORMAT  по  возможности
восстановит и все остальные поврежденные дорожки на дискете.

     После восстановления дискеты  рекомендую  проверить  ее NDD,
для   того,   чтобы   найти    оставшиеся   области    с   плохой
намагниченностью.

     Дополнительные ключи:
     /R0 - при  плохом  качестве дискеты  восстановленные дорожки
перестают  читаться через  некоторое  время.  Этот ключ позволяет
восстанавливать  только 0 дорожку,  а все остальные дорожки будут
помечаться как обычно.
     /MT -  если /R0 плохо  помогает,  то можно,  используя  этот
ключ, помечать целиком дорожку, чтобы не было дальнейших проблем.
Однако в этом случае в BAD попадает, возможно, большое количество
хороших   секторов,   что    уменьшает    количество   свободного
пространства  на  дискете. Но иногда  единственный  компромиссный
вариант - это использование ключей /R0 и /MT.

Проблемы с PU_1700: теперь их нет
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     PU_1700,  при всяких прочих достоинствах, имеет особенность,
а  именно:  при попытке форматирования дискеты любой  программой,
игнорирует заданный порядок расположения  секторов  и форматирует
по-своему.  Вследствие  этого факта, и  FFORMAT  и  любая  другая
программа,  задающая  свое  собственное  расположение   секторов,
правильно работать не могут: происходит замедление форматирования
в 1.4 раза (фактически за время, требующееся для форматирования 4
дискет,   можно  реально  отформатировать   всего   лишь   3)   и
игнорируется  правильное  расположение секторов. С  PU_1700 можно
отформатировать дискету в режиме оптимального размещения секторов
в любой  программе, но это будет медленнее, чем это можно было бы
сделать  имея  сугубо  специализированную  программу  для  такого
форматирования  (FFORMAT форматирует быстрее чем PU_1700, даже  с
оптимальным расположением  секторов).  В связи с этим FFORMAT  на
время своей работы отключает PU_1700.

     В данном случае PU_1700 имеет единственное достоинство перед
800,  которое заключается в  том,  что PU_1700  умеет  копировать
дискету 1.44 3'5" на 1.44 5'25". 800 этого  сделать не позволяет.
PU_1700 нужно было бы задавать собственное  расположение секторов
только  если  ее  запускают с  параметром  /sm=,  но  таких людей
достаточно  мало:  сложно  разобраться  в  параметрах  программы.
PU_1700, на мой взгляд, в гораздо большей степени осложняет жизнь
различным защитам от копирования и копировщикам чем 800.

     Однако  теперь  вы  можете  пользоваться PU_1700  совершенно
спокойно, это нисколько не ухудшит качеств FFORMAT.

     FFORMAT распознает  два варианта PU_1700:  версия 3.0 и 3.1.
Это  обозначает  версию  3.0  и ниже  и  3.1 и выше. Информация о
найденном  драйвере  отображается в верхнем  левом  углу  экрана.
Пользователям все равно, а  с точки зрения программиста они имеют
различные  способы  инициализации  и,  как  следствие,  различные
адреса  внутренних  данных.  Кроме   PU_1700  FFORMAT  отображает
наличие 800.

По поводу загрузочных дискет и прочего
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     FFORMAT  умеет  делать   загрузочную  дискету  на  любом  из
доступных  форматов и  под  любой версией  DOS,  а также задавать
метку  диска  (volume  label).  Однако  я  НЕ  рекомендую  делать
загрузочную  дискету  нестандартного  формата, так  как  с  такая
дискета может не загружаться на XT или на AT'шках с нестандартным
BIOS. Прежде чем "штамповать"  загрузочные дискеты нестандартного
формата  рекомендую проверить будет ли ваша  машина загружаться с
такой   дискеты.  Если  при  изготовлении   загрузочной   дискеты
нестандартного   формата    FFORMAT    отказывается    записывать
операционную систему (сообщает об ошибке записи), загрузите 800 и
попробуйте еще раз. В настоящей  версии  FFORMAT  появление такой
ошибки  маловероятно,  так как  используется  встроенный драйвер,
выполняющий те-же функции, что и  800. Если ошибка появляется, то
возможно, что вы никогда не сможете сделать эту дискету системной
- это относится к форматам 720 Кб на дисководе  1.2 М - возможно,
что BIOS не может поддерживать такой  формат (даже с 800), просто
нестандартный   BIOS.   Для   работы   с  таким   BIOS'ом   можно
рекомендовать  использовать DRV720. Он  должен  быть активен  при
работе FFORMAT.

     При записи операционной системы файл  COMMAND.COM помечается
как доступный только по чтению (ReadOnly).

     Форматирование на  1.44  Мб  на  дисководе  1.2  и  1.68  на
дисководе  1.44 не менее  надежны,   чем  стандартные  форматы  -
независимо от количества секторов, контроллер  записывает одно  и
тоже  количество   физических   данных.  При  меньшем  количестве
секторов  дискета имеет  большие промежутки между секторами и они
никак  не  используются.  Однако, если  вы пользуетесь  дискетами
низкого  качества, вы можете  получить интересный  эффект. На 1.2
дискета  форматируется  нормально, а  на  1.44 с плохими блоками.
Объяснение  этому  факту следующее:  при  форматировании  на  1.2
области  с  плохой  намагниченностью попадают в промежутки  между
секторами. Со временем такая дискета начинает сбоить  и на 1.2 Мб
формате.   Единственное   предостережение    при    использовании
нестандартных  форматов:  НЕ  ПРОВЕРЯЙТЕ  ДИСКЕТЫ  НЕСТАНДАРТНОГО
ФОРМАТА при  помощи NDD,  если  дискета содержит больше 40 или 80
дорожек! Используйте CHKDSK.  NDD  "вылечит" их в соответствующий
формат дисковода 360 Кб, 720 Кб, 1.2 или 1.44 Мб.

ВНИМАНИЕ!

       Для нормальной работы дискет нестандартного формата, в том
       числе  и  1.44 на 1.2  дисководе и 1.6  на 1.44 дисководе,
       естественно  требуется  загрузить 800  или PU_1700, однако
       для форматирования это не обязательно.

       Форматирование со скоростью DOS'овского FORMAT не является
       рекламной  уловкой, а  тем более  не  допускает  ухудшения
       качества форматирования.

       Если вы все-же  используете дискету нестандартного формата
       в качестве загрузочной,  то  вызовите 800  или  PU_1700 из
       вашего  AUTOEXEC.BAT,  иначе дискета  перестанет  читаться
       после загрузки.

       При использовании дополнительных дорожек (82-83 или 42-43)
       проверьте  дискету  на  предмет  их присутствия какой-либо
       утилитой.

     FFORMAT  имеет  проверку   дискеты   перед   форматированием
(которую  можно   отключить).   В  случае,  если   дискета   была
форматирована и на  ней  находятся  файлы, выдается  список  этих
файлов.  Вы   можете  просматривать  каталоги,  как  в  Norton'е.
Сообщение что-то типа "Этот диск может  содержать данные, которые
будут  потеряны  в  процессе  форматирования.  Форматировать  ?",
говорит о том, что невозможно прочитать корневой каталог. Если же
файлы отсутствуют то выдается сообщение: "Этот диск уже  когда-то
был  форматирован,  переформатирование  это  немного  потерянного
времени.  Форматировать  ?".  На последнее  сообщение  рекомендую
всегда отвечать "Format", так как:

     1) магнитный слой дискет имеет тенденцию разрушаться и
        размагничиваться со временем

     2) FFORMAT имеет специфический способ пометки сбойных
        участков: помечает то, что действительно сбоит. Поэтому
        на дискете у вас окажется, возможно, больше свободного
        места чем было до форматирования FFORMAT'ом, в случае
        сбоев FFORMAT, по возможности, "восстановит" поврежденные
        сектора дискеты

     3) Дискета могла быть форматирована другой программой и
        имеет обычное расположение секторов или большое
        количество сбойных секторов

     Появление сообщения вроде "Диск имеет невосстановимую ошибку
в системной области и не может  быть форматирован" обозначает то,
что  либо действительно  повреждена  нулевая  дорожка на дискете,
либо  вы пытаетесь форматировать дискету 1.2  Мб на дисководе 360
Кб,  либо  ваш  дисковод,  в  силу  различных  причин,  не  может
поддерживать данный формат - попробуйте формат поменьше.

     При  форматировании с последовательным номерами  секторов на
дисководе 1.2 Мб максимальное число  секторов равно 17, однако на
диске  можно разместить  18  секторов  на  дорожку.  Дисковод  не
успевает  обрабатывать  такое  большое количество  секторов.  Для
обеспечения  работоспособности 18 секторов на дорожку  (1.2 Мб) и
21 сектор  на  дорожку (1.44 Мб),  такие форматы форматируются  с
чередованием  секторов  (Interlive=2).   Такие  дискеты  работают
несколько  медленнее, чем стандартные  (а конкретно в два  раза).
При  помощи ключа  /I можно  заставить  FFORMAT  форматировать  с
интерливом 2.

     Количество смещаемых секторов при оптимальном форматировании
подобрано так,  что обеспечивает увеличение производительности не
только с быстрыми контроллерами AT, но и  относительно медленными
контроллерами  XT  (фактически  /sm=2   в  PU_1700).  Однако  при
форматировании на высокую  плотность  скорость реакции  дисковода
1.2 Мб  и  1.44 Мб выше,  поэтому FFORMAT  автоматически выбирает
смещение секторов и форматы от 1.2 Мб и выше форматируются как бы
с  /sm=1.  Такой  подход  позволяет  сохранить  совместимость  по
производительности с дисководами 360 и 720 Кб и сильнее увеличить
производительность дискет от 1.2 Мб и выше.

     FFORMAT  записывает две версии BOOT-сектора (для системной и
обычной  дискет)  и  обе  они  совместимы  с  DOS  5.0  -   3.30.
Незагрузочный BOOT выдает DeskTop  с окном, предупреждающим,  что
эта дискета не является загрузочной.
     Правила  пользования  BOOT'ом:  после   того,   как  увидите
приглашение,  вы  можете  нажать  пробел, ввод  или  подсвеченную
букву на кнопке.  Извините,  но драйвер  мыши  в  BOOT-сектор  не
уместился.
    При  помощи  опции  /BOOT  можно   подключить  любой  внешний
загрузочный сектор, имеющий расширенную таблицу BPB.

Внутренние ошибки
~~~~~~~~~~~~~~~~~
     Внутренние  ошибки,  генерируемые  программой (обнаружены  в
процессе эксплуатации):

     Internal error 200: возможно вы загрузили PU_1700 поверх 800
                         - они конфликтуют между  собой. Если нет
                         возможности   перезагрузки,   попробуйте
                         вызвать FFORMAT сделав каталог с FFORMAT
                         текущим (?!).

     Если  при   запуске  FFORMAT   на   сервере  локальной  сети
блокируется  доступ  к серверу,  попробуете опцию /SW,  при  этом
FFORMAT  не будет блокировать INT 2F, функцию 4B02. Если  вы  при
этом переключите FFORMAT Task Swaper'ом, то за внешний вид  после
переключения обратно я не отвечаю.

О том, как работать с программой
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     После запуска, в окне  "Drives" выберите нужный дисковод,  в
окне  "Available" -  нужный формат  диска.  В  окне  "Perfomance"
можете   выбрать   режим  стандартного  форматирования  (Standart
DOS  mode), режим полу-стандартного форматирования (Standart fast
mode)  или  форматирование  с  оптимизацией  секторов   (Optimize
sectors),  а также  установить  режим быстрого форматирования.  В
окне  "Other  options"   задается  метка  тома  (Label)  и  опция
копирования системных файлов на дискету, можно отключить проверку
наличия файлов на диске, а также отключить восстановление дискет.

     В подменю "Options" устанавливаются параметры FFORMAT, в том
числе  определяющие  внешний  вид  FFORMAT,  а  также  вы  можете
отменить автоопределение типов дисководов в случае, если реальные
типы  дисководов  не  соответствуют типам  при автоопределении. У
меня есть программа FDS (Floppy Drives  Setup), которая позволяет
изменять информацию DOS о типе дисководов даже на 2.88 Мб (однако
я пока не могу найти хотя-бы один дисковод, поддерживающий  такой
формат).
        ┌ Format options ───────────────────────────────┐
        │ [x]   Full rebuilding    [ ]   Mark by tracks │
        └───────────────────────────────────────────────┘
     Full rebuilding   -  заставляет  FFORMAT  при  необходимости
восстанавливать не только нулевую дорожку,  но и  все  остальные.
Отменяется параметром /R0 из командной строки.
     Mark by  tracks  -  (в  предыдущих  версиях  "Mark   track")
аналогично параметру /MT, заставляет помечать целиком дорожку при
наличии хотя-бы 1 сбойного сектора.
        ┌ Other options ────────────────────────────────┐
        │ [ ]   CGA snow check     [ ]   Fill desktop   │
        │ [ ]   Mono colors        [x]   Beep when done │
        │ [x]   Zooming boxes      [x]   Graphic frames │
        │ [ ]   Russian message    [x]   Clear keyboard │
        └───────────────────────────────────────────────┘
     CGA snow  check  -  для  подавления  снега на CGA мониторах.
Устанавливается автоматически при первом запуске.
     Mono colors  -  включает  режим  преобразования  цветов  для
черно-белого монитора.  На   Hercules   и   MDA   устанавливается
автоматически.
     Zooming boxes - разрешает раскрывающиеся окна.
     Russian messege - переключает сообщения на русский язык.
     Fill desktop - разрешает заполнять фон  символом  '▒'.  Если
фон не заполнять, то FF начинает выглядеть а-ля NU 6.0
     Beep when done -  разрешает  звуковой  сигнал  по  окончании
форматирования. Сильно похож на Speedisk.
     Graphic frames - разрешает  программировать  знакогенератор.
Автоматически   отключается    при    запуске   из-под   DESQview
или Windows.
     Clear  keyboard  -  позволяет   отключить  очищение   буфера
клавиатуры для выполнения однотипных действий.

Небольшое ограничение
~~~~~~~~~~~~~~~~~~~~~
Если на вашем  BIOS 800 не поддерживает 720 Кб, то FFORMAT в этом
деле ничем не поможет. Используйте FFORMAT совместно с DRV720.

ПРИЛОЖЕНИЕ.

                              "Если бы строители  строили  здания
                              так  же,  как   программисты  пишут
                              программы,   то  первый  залетевший
                              дятел разрушил бы цивилизацию."
                                                    (Закон Мерфи)

Некоторые ошибки и несовместимости, найденные в процессе работы
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
BIOS     Если говорить честно, то  разработчики  BIOS  меня   уже
         достали... Каждая фирма, которая написала BIOS сует туда
         что-то свое, причем в разных версиях разное,  а ты потом
         разбирайся, чего они туда понапихали...  Ниже рассказано
о  6 функции  10h прерывания BIOS 1982 года,  а сейчас  о другом.
Пришел тут как-то  ко  мне один знакомый -  он  поставил  себе на
машину  вместо  CG'овой карты EG'овую  -  и  говорит мол, что его
программа прекрасно работала на  CGA и перестала работать,  когда
он   сменил  карту.  Причем  на  соседней  машине  его  программа
работает. Ну, стали  разбираться  и выяснили, что  функция вывода
символа на его  BIOS (т.е EG'овой карты) портит регистр AX... Что
же  касается BIOS  доступа к флопам, то  тут  ситуация следующая.
Некоторые BIOS'ы портят  не-то  регистр  BP,  не-то  DS не-то оба
сразу, причем не всегда... Любые дополнительные  карты для XT 1.2
Мб написаны из рук вон плохо. Они, конечно, обеспечивают 1.2 Мб и
360 Кб как написано  в документации на  них, к  этому  придраться
нельзя,  но  они  обеспечивают  ТОЛЬКО  ЭТО  И  БОЛЬШЕ  НИЧЕГО  !
Форматировать на 800  Кб  или  (на некоторых)  с 800.COM в памяти
просто  НЕВОЗМОЖНО  !  Они на  это  НЕ  РАССЧИТАНЫ.  А причина-то
следующая: у BIOS есть  байт состояния для каждого флопа, который
описывает  текущее  состояние  т.е.  скорость  передачи,  наличие
Double Step (для  360 Кб) и т. д. - его-то 800 и  меняет. Так вот
биты  в нем не соответствуют стандарту, который вроде-бы никто не
изобретал  (полное  отсутствие форматирования), или  находится  в
другом месте, известном только ему (BIOS'у) или и то и  другое...
Мало того, на этих платах BIOS не тянет секторов больше, чем надо
по стандарту  - мелочь, а восстановление дискет  на таких BIOS'ах
не  работает. Выход из  этого положения  только один  -  написать
собственный  BIOS  для дискет и  поставлять  его  вместе  с  этой
программой.  При  необходимости пользователь загрузит  - и  все в
порядке...

PU_1700  конфликтует с RELEASE'ом, причем не только при удалении.
         RELEASE портит  часть  кода  PU_1700, поэтому рекомендую
         при использовании RELEASE  запускать  PU_1700  с  опцией
         /PSP, в этом случае программы не конфликтуют.
Машина зависала при обращении к Int 21h, AX=440Dh, CX=860h.  Взяв
свою  любимую отмычку (Turbo Debugger)  я  трассировал обработчик
этого  вызова в PU_1700  и  обнаружил,  что  после вызова старого
обработчика Int  21h AH=62h, следующей исполняемой командой будет
нечто вроде:
             mov FS,[bx+si]     (на 86 процессоре ...!)

RELEASE неправильно определяет  размер резидентной части PU_1700.
При использовании опции /PSP никаких конфликтов не возникло.

HIEW.EXE Программа, прямо скажем, весьма удобная, но  версия 2.86
         вешала компьютер с  BIOS'ом  1982  года  - при вызове  6
         функции  10h прерывания (именно она используется там для
         очистки экрана) этот BIOS портит регистр BP, причем  все
об   этом  как-то  знают  (оболочки   ведь  работают),   или   не
восстанавливают  регистр  SP  из регистра BP.  {В версии 4.00 эта
ошибка была исправлена}. Кстати о 6 и  7 функции  10h прерывания.
Если высота окна меньше, чем число строк для сдвига, то BIOS 1982
года  ловит очередной  глюк:  очищаемая  область разрастается  до
неимоверных  размеров  по  вертикали и содержит случайные данные.
Эффект  обнаружен в  Norton Commander  4.0  (Symantec  Inc.)  при
операциях  с архивами  (кроме Commander Compression).  Далее  про
HIEW.EXE, при  работе с  Hercules'ом  на  экране кроме  верхней и
нижней  строки  ВООБЩЕ НИЧЕГО НЕ ВИДНО! Господа,  но  атрибуты-то
нужно  переопределять.  Общая  ошибка  большинства  программ  при
работе с Hercules'ом: курсор должен находится в позициях Bh и Ch,
а  не посередине  строки  (6h,  7h),  эмуляция  CGA  курсора  там
ОТСУТСТВУЕТ: адаптер сделан раньше, чем CGA. Эта ошибка была даже
в ADINF'е!

800.COM  То, что он не работает на некоторых версиях BIOS не вина
         автора,   но   что  происходит  с  именем   программы  в
         Enviroment при вызове  int 21h,  ax=440dh, cx=860h  это,
         простите,   слишком.   800   проверяет   имя   вызвавшей
программы, но  все ничего,  если бы не  одно  обстоятельство:  он
переводит имя в верхний регистр при помощи операций вроде:
        std
 lp:
        and  [si],DFh
        ...
        dec  si
        loop lp

автор задумывался хоть на секунду, что будет с точками и  цифрами
при "переводе" в  верхний регистр?  Результат  действия  примерно
таков:

      до D:\WORK\TEST.EXE
   после D:\WORK\TESTEXE

Так, что господа, проверяйте свои ошибки!

К  этому нужно добавить, что я тоже не безгрешен (об этом говорит
большое  количество  выпущенных  версий).  До  версии  2.80  мною
использовался алгоритм распознавания переприсвоенных накопителей,
который вешал компьютер при наличии  дискового кеша, причем вешал
на сам  алгоритм  распознавания,  а  кеш  при  попытке  прочитать
что-либо с диска и в случайных местах - возможно,  что это ошибка
SMARTDRIVE - плевать куда-то в память произвольные числа...
Одна  из  причин   зависания   FFORMAT  при   запуске  совместное
использование RELEASE и PU_1700 без /PSP.

Информация для любителей переделывания VFORMAT во что-либо другое
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
VFORMAT содержит некоторое количество ошибок. Я не утверждаю, что
нашел все - возможно что-то еще и вылезет (список пополняется):

     1)  VFORMAT  считает, что дисководами 1.2 или 1.44  Мб может
обладать только машина класса AT, но никак не XT - что в корне не
верно: я  сам знаю  XT'шки, комплектующиеся дисководами 1.2  Мб и
расширителем  BIOS (дополнительной  картой)  для  поддержки таких
дисководов (правда они имели совсем "левый" BIOS и  800  Кб диски
на них не читаются и не пишутся вообще, однако из этого положения
вышли, написав  специальный драйвер).  В  результате VFORMAT - не
переустанавливает  параметры  дисковода   при  форматировании   и
результат такого форматирования непредсказуем.

     2) При определении типа накопителя не обнуляется первый байт
блока  запроса   IOCTL   (он  принимает  случайное  значение).  В
результате VFORMAT иногда  "лазит" в дисковод до форматирования и
если диск уже был форматирован - получает неверные параметры BPB,
правда (к счастью!) их не использует.

     3) - самое крутое - при наличии  поддержки 18h функции 13h
прерывания не  происходит  переустановка накопителя B: -  попытка
форматирования  может  оказаться  безрезультатной,   мало   того,
переустанавливается всегда накопитель A:, что является интересной
шуткой. При вызове функций переустановки  накопителя 17h  или 18h
BIOS  включает мотор переустанавливаемого  дисковода  (зажигается
лампочка на  панели  дисковода), а поскольку  переустанавливается
только дисковод A:, то при  попытке форматирования B:  зажигается
лампочка на дисководе A:, горит несколько секунд, гаснет и только
тогда начинает работать  B:.
     Причина такого поведения заключается в следующем: при вызове
18h функции 13h прерывания номер диска помещается в регистр DL, а
VFORMAT  помещает   его  в   регистр  DH.  При  вызове  процедуры
INTR($13,REGS) неиспользованные регистры обнуляются, обнуляется и
DL - результат: переустановка накопителя A:.

     4) при  форматировании  дискет  720  Кб  на  дисководе  3'5"
неверно    выставляет    скорость   передачи    данных:   дискета
форматируется и иногда читается.

     5) если  при  форматировании   VFORMAT   нажать  Ctrl-Break,
вываливается  не восстанавливая  вектор  1E  -  дискеты перестали
читаться вообще.

Скорости передачи данных
~~~~~~~~~~~~~~~~~~~~~~~~
Дисковод

360-720 5'25"  - 300 Кбит
    720 3'5"   - 250 Кбит
    1.2 5'25"  - 300 Кбит (DD) 500 Кбит (HD)
   1.44 3'5"   - 250 Кбит (DD) 500 Кбит (HD)
   2.88 3'5"   - ??? (думаю, что 1000 Кбит)

Дисковод 1.44 Мб вообще интересен тем,  что  при той-же  скорости
передачи  данных  обеспечивает гораздо  более  высокую  плотность
записи,  чем дисковод 1.2 Мб.  По этой причине при форматировании
на 720-800 Кб скорость передачи ниже.

Как  я форматирую со скоростью DOS'овского FORMAT или до чего  не
догадался Peter Norton
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Что делает FORMAT  я, честно  говоря,  не  знаю, но  решение
проблемы лежало на поверхности: достаточно сместить перед началом
форматирования   заполненную  маску   секторов   на +3   и  затем
форматировать дискету.  Эффект прост -  форматирование и проверка
осуществляется за  2.3 оборота  диска  а не за 3, как при обычном
форматировании   (SafeFormat,   DOS  Mode).  Такая   дискета   по
производительности  аналогична   той,  которую  вы  получите  при
форматировании FORMAT'ом или SafeFormat, а форматируется быстрее,
чем  при  помощи  любых  других  утилит  (кроме  DOS  FORMAT  без
всевозможных примочек, конечно).
